"use strict";(self.webpackChunkvideoteca_frontend=self.webpackChunkvideoteca_frontend||[]).push([[846],{7411:function(e,t,r){var o=r(4165),n=r(5861),a=r(3263),s=r(9778),c="https://sccotview.com/api/",u=["free/","free"],i=(localStorage.getItem("access_token"),a.Z.create({baseURL:c,timeout:5e3,headers:{"Content-Type":"multipart/form-data",accept:"application/json"}}));i.interceptors.request.use((function(e){var t=localStorage.getItem("access_token"),r=u.some((function(t){return e.url.includes(t)}));return t&&!r?e.headers.Authorization="JWT "+t:delete e.headers.Authorization,e})),i.interceptors.response.use((function(e){return e}),function(){var e=(0,n.Z)((0,o.Z)().mark((function e(t){var r,n,a,u,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.config,"undefined"!==typeof t.response){e.next=4;break}return console.warn("A server/network error occurred. Looks like CORS might be the problem."),e.abrupt("return",Promise.reject(t));case 4:if(401!==t.response.status||r.url!==c+"api/token/refresh/"){e.next=7;break}return window.location.href="/userlogin1/",e.abrupt("return",Promise.reject(t));case 7:if("token_not_valid"!==t.response.data.code||401!==t.response.status||"Unauthorized"!==t.response.statusText){e.next=37;break}if(!(n=localStorage.getItem("refresh_token"))){e.next=34;break}if(a=JSON.parse(s.lW.from(n.split(".")[1],"base64").toString()),u=Math.ceil(Date.now()/1e3),!(a.exp>u)){e.next=29;break}return e.prev=13,e.next=16,i.post("api/token/refresh/",{refresh:n});case 16:return l=e.sent,localStorage.setItem("access_token",l.data.access_token),localStorage.setItem("refresh_token",l.data.refresh_token),i.defaults.headers.Authorization="JWT "+l.data.access_token,r.headers.Authorization="JWT "+l.data.access_token,e.abrupt("return",i(r));case 24:e.prev=24,e.t0=e.catch(13),console.log(e.t0);case 27:e.next=32;break;case 29:console.log("Refresh token is expired",a.exp,u),localStorage.clear(),window.location.href="/userlogin2/";case 32:e.next=37;break;case 34:console.log("Refresh token not available."),localStorage.clear(),window.location.href="/userlogin3/";case 37:return 401===t.response.status&&localStorage.clear(),e.abrupt("return",Promise.reject(t));case 39:case"end":return e.stop()}}),e,null,[[13,24]])})));return function(t){return e.apply(this,arguments)}}()),t.Z=i},1846:function(e,t,r){r.r(t),r.d(t,{default:function(){return i}});var o=r(4165),n=r(5861),a=r(2791),s=r(7411),c=r(7689),u=r(184);function i(){var e=(0,c.s0)();return(0,a.useEffect)((function(){var t=function(){var t=(0,n.Z)((0,o.Z)().mark((function t(){return(0,o.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,s.Z.post("logout/",{refresh_token:localStorage.getItem("refresh_token")});case 3:localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),delete s.Z.defaults.headers.Authorization,e("/loginuser"),window.location.reload(),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("Error during logout",t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}();t()}),[e]),(0,u.jsx)("div",{children:"Logout"})}}}]);
//# sourceMappingURL=846.7d96f7a8.chunk.js.map