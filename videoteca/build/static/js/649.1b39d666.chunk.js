"use strict";(self.webpackChunkvideoteca_frontend=self.webpackChunkvideoteca_frontend||[]).push([[649],{7411:function(e,t,r){var n=r(4165),o=r(5861),a=r(3263),s=r(9778),i="https://sccotview.com/api/",c=a.Z.create({baseURL:i,timeout:5e3,headers:{Authorization:localStorage.getItem("access_token")?"JWT "+localStorage.getItem("access_token"):null,"Content-Type":"multipart/form-data",accept:"application/json"}});c.interceptors.response.use((function(e){return e}),function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){var r,o,a,l;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.config,"undefined"!==typeof t.response){e.next=4;break}return console.warn("A server/network error occurred. Looks like CORS might be the problem. Sorry about this - we will get it fixed shortly."),e.abrupt("return",Promise.reject(t));case 4:if(401!==t.response.status||r.url!==i+"api/token/refresh/"){e.next=7;break}return window.location.href="/loginuser/",e.abrupt("return",Promise.reject(t));case 7:if("token_not_valid"!==t.response.data.code||401!==t.response.status||"Unauthorized"!==t.response.statusText){e.next=26;break}if(!(o=localStorage.getItem("refresh_token"))){e.next=24;break}if(a=JSON.parse(s.lW.from(o.split(".")[1],"base64").toString()),l=Math.ceil(Date.now()/1e3),console.log(a.exp),!(a.exp>l)){e.next=17;break}return e.abrupt("return",c.post("api/token/refresh/",{refresh:o}).then((function(e){return localStorage.setItem("access_token",e.data.access_token),localStorage.setItem("refresh_token",e.data.refresh_token),c.defaults.headers.Authorization="JWT "+e.data.access_token,r.headers.Authorization="JWT "+e.data.access_token,c(r)})).catch((function(e){console.log(e)})));case 17:console.log("Refresh token is expired",a.exp,l),window.localStorage.removeItem("access_token"),window.localStorage.removeItem("refresh_token"),window.localStorage.removeItem("user"),window.location.href="/loginuser/";case 22:e.next=26;break;case 24:console.log("Refresh token not available."),window.location.href="/loginuser/";case 26:return 401===t.response.status&&(window.location.href="/loginuser/"),e.abrupt("return",Promise.reject(t));case 28:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.Z=c},6649:function(e,t,r){r.r(t),r.d(t,{default:function(){return _}});var n=r(4942),o=r(1413),a=r(9439),s=r(2791),i=r(7689),c=r(5628),l=r(272),u=r(6513),d=r(8257),p=r(6194),f=r(1288),m=r(8302),g=r(8596),h=r(3712),x=r(5987),w=r(184),v=["message"],k=(0,g.Z)((function(e){return{link:{margin:e.spacing(1,1.5)}}}));var b=function(){var e=k();return function(t){var r=t.message;(0,x.Z)(t,v);return r?(0,w.jsx)("p",{className:e.link,style:{fontSize:"25px",color:"red"},children:r}):(0,w.jsx)("p",{})}},Z=r(1830),S=r.n(Z),C=(r(7087),(0,g.Z)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center",backgroundColor:"white",color:"black",padding:"30px",borderRadius:"15px",boxShadow:"5px 5px 10px #222261"},avatar:{margin:e.spacing(1),backgroundColor:"dark",width:"80px",height:"80px",border:"2px solid #4949a5"},form:{width:"100%",marginTop:e.spacing(1)},texto:{backgroundColor:e.palette.common.white},submit:{margin:e.spacing(3,0,2),padding:"12px 0"}}})));function _(e){var t=e.onLogin,r=(0,i.s0)(),g=(0,c.Z)(),x=g.isLoginLoading,v=g.hasLoginError,k=g.login,Z=g.isLogged,_=g.errLogin,j=(0,s.useState)(""),I=(0,a.Z)(j,2),y=I[0],T=I[1],L=Object.freeze({email:"",password:""}),W=b(),N=(0,s.useState)(L),z=(0,a.Z)(N,2),E=z[0],O=z[1],A=(0,s.useState)(!0),P=(0,a.Z)(A,2),R=P[0],J=P[1],B=function(e){var t=e.target,r=t.name,a=t.value;O((function(e){var t=(0,o.Z)((0,o.Z)({},e),{},(0,n.Z)({},r,a.trim()));return J(!(t.email&&t.password)),t}))};(0,s.useEffect)((function(){Z&&S().fire({title:"Bienvenido(a) a SCCOTVIEW",html:"<p style='font-size:17px'>Esta plataforma de videos tiene im\xe1genes y contenido sensible, fruto del dedicado esfuerzo de nuestros especialistas. Disfruta de esta herramienta exclusiva de la SCCOT, creada para ti. <br /><br /> \xa1Gracias por ser parte de nuestra comunidad y a nuestros expositores por su invaluable contribuci\xf3n a la ciencia y la investigaci\xf3n!</p>",imageUrl:"https://sccotview.com/media/videos/SCCOTVIEWLSHORT.png",imageWidth:110,imageHeight:110,imageAlt:"Logo SCCOTVIEW",confirmButtonText:"Aceptar",confirmButtonColor:"rgb(63, 81, 181)"}).then((function(){r("/"),t&&t(),window.location.reload()}))}),[r,Z,t]),(0,s.useEffect)((function(){v&&(S().fire({title:""!=_?_:"Lo sentimos no fue posible iniciar sesi\xf3n",html:"Puede contactarnos al correo membresias@sccot.org.co <br /> <a href='wa.link/mmff0z'><input type='button' class='btn btn-outline-success' value='WhatsApp' /></a>",icon:"error"}),setTimeout((function(){T(null)}),5e3))}),[v]);var D=C();return(0,w.jsxs)("div",{className:"mt-4",children:[x&&(0,w.jsxs)("strong",{className:"d-flex justify-content-center flex-column align-items-center",children:[(0,w.jsx)("div",{className:"spinner-grow text-light ",role:"status"}),(0,w.jsx)("span",{className:"sr-only d-inline h4 mt-1",children:"Espera por favor"})]}),!x&&(0,w.jsxs)(h.Z,{component:"main",maxWidth:"xs",children:[(0,w.jsx)(d.ZP,{}),(0,w.jsxs)("div",{className:D.paper,children:[(0,w.jsx)(l.Z,{className:D.avatar}),(0,w.jsx)(m.Z,{component:"h1",variant:"h5",children:"Iniciar sesi\xf3n"}),(0,w.jsxs)("form",{className:D.form,noValidate:!0,children:[(0,w.jsx)(p.Z,{className:D.texto,margin:"normal",required:!0,fullWidth:!0,id:"email",label:"Correo Electr\xf3nico",name:"email",autoComplete:"email",autoFocus:!0,onChange:B}),(0,w.jsx)(p.Z,{className:D.texto,margin:"normal",required:!0,fullWidth:!0,name:"password",label:"Contrase\xf1a",type:"password",id:"password",autoComplete:"current-password",onChange:B}),(0,w.jsx)(u.Z,{type:"submit",fullWidth:!0,variant:"contained",color:"primary",className:D.submit,onClick:function(e){e.preventDefault(),k({username:E.email,password:E.password})},disabled:R,children:"Ingresar"}),(0,w.jsx)(f.Z,{container:!0,children:(0,w.jsx)(f.Z,{item:!0,xs:!0,children:(0,w.jsx)("a",{href:"javascript:void(0);",className:"cursorPointer text-dark",onClick:function(){S().fire({title:""!==_?_:"\xbfOlvid\xf3 su contrase\xf1a?",html:"Puede contactarnos al correo membresias@sccot.org.co <br /> o cont\xe1ctenos por <a class='text-success' href='https://wa.link/mmff0z' target='_blank'>WhatsApp</a>",confirmButtonText:"Entendido",confirmButtonColor:"#3f51b5",icon:"info"})},children:"\xbfOlvid\xf3 su contrase\xf1a?"})})})]})]})]}),v&&(0,w.jsx)(W,{message:y})]})}},5628:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(9439),o=r(2791),a=r(7689),s=r(2680),i=r(746),c=r(7411);r(1830);function l(){var e=(0,a.s0)(),t=(0,o.useContext)(s.Z),r=t.jwt,l=t.setUSER,u=t.setJWT,d=(0,o.useState)({loading:!1,error:!1}),p=(0,n.Z)(d,2),f=p[0],m=p[1],g=(0,o.useState)(""),h=(0,n.Z)(g,2),x=h[0],w=h[1],v=(0,o.useCallback)((function(e){var t=e.username,r=e.password;m({loading:!0,error:!1}),(0,i.m3)({username:t,password:r}).then((function(e){window.localStorage.setItem("access_token",e.data.access_token),window.localStorage.setItem("refresh_token",e.data.refresh_token),window.localStorage.setItem("user",JSON.stringify(e.data.user)),c.Z.defaults.headers.Authorization="JWT "+localStorage.getItem("access_token"),m({loading:!1,error:!1}),u(e.data.access_token),l(e.data.user)})).catch((function(e){window.localStorage.removeItem("access_token"),window.localStorage.removeItem("refresh_token"),window.localStorage.removeItem("user"),m({loading:!1,error:!0}),console.log(e),w(e.response.data.error||e.response.data.detail)}))}),[u,l]),k=(0,o.useCallback)((function(){c.Z.post("logout/",{refresh_token:localStorage.getItem("refresh_token")}),localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token"),localStorage.removeItem("user"),c.Z.defaults.headers.Authorization=null,u(null),e("/"),window.location.reload()}),[e,u]);return{isLogged:Boolean(r),isLoginLoading:f.loading,hasLoginError:f.error,login:v,logout:k,errLogin:x}}},746:function(e,t,r){r.d(t,{PR:function(){return l},gO:function(){return u},m3:function(){return c}});var n=r(4165),o=r(5861),a=r(3263),s=r(7411),i="https://sccotview.com/api/",c=function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.Z.post(i+"login/",t);case 2:return r=e.sent,console.log(r),console.log(t),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),l=function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t){var r;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.Z.get("".concat(i,"users/").concat(t));case 2:if(200!==(r=e.sent).status){e.next=8;break}return console.log(r),e.next=7,r.data;case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),u=function(){var e=(0,o.Z)((0,n.Z)().mark((function e(t,r){var o;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.Z.patch("".concat(i,"users/").concat(t,"/"),r);case 2:if(200!==(o=e.sent).status){e.next=7;break}return e.next=6,o.data;case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}()}}]);
//# sourceMappingURL=649.1b39d666.chunk.js.map